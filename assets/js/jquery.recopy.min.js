(function($){$.fn.relCopy=function(options){var settings=jQuery.extend({excludeSelector:".exclude",emptySelector:".empty",copyClass:"copy",append:"",clearInputs:true,limit:0},options);settings.limit=parseInt(settings.limit);this.each(function(){$(this).click(function(){var rel=$(this).attr("rel");var counter=$(rel).length;if(settings.limit!=0&&counter>=settings.limit){return false}var master=$(rel+":first");var parent=$(master).parent();var clone=$(master).clone(true).addClass(settings.copyClass+counter).append(settings.append);if(settings.excludeSelector){$(clone).find(settings.excludeSelector).remove()}if(settings.emptySelector){$(clone).find(settings.emptySelector).empty()}if($(clone).attr("id")){var newid=$(clone).attr("id")+(counter+1);$(clone).attr("id",newid)}$(clone).find("[id]").each(function(){var newid=$(this).attr("id")+(counter+1);$(this).attr("id",newid)});if(settings.clearInputs){$(clone).find(":input").each(function(){var type=$(this).attr("type");switch(type){case"button":break;case"reset":break;case"submit":break;case"checkbox":$(this).attr("checked","");break;default:$(this).val("")}$(this).attr("name",function(i,oldVal){if(!oldVal){return false}return oldVal.replace(/\[(\d+)\]/,function(_,m){return"["+$(rel).length+"]"})})});$(clone).find("select").each(function(){$(this).val("other").change()})}$(clone).find("button").each(function(){$(this).attr("onclick","jQuery(this).parent().parent().remove(); return false")});$(parent).find(rel+":last").after(clone);return false})});return this}})(jQuery);